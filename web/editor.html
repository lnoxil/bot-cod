<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Full Discord Editor</title>
  <style>
    body{font-family:Inter,Arial,sans-serif;background:#0f1115;color:#fff;margin:0}
    .wrap{display:grid;grid-template-columns:1.1fr 1fr;gap:18px;padding:18px}
    .card{background:#161b24;border-radius:12px;padding:14px}
    label{display:block;margin:8px 0 6px;color:#cdd9e5;font-size:13px}
    input,textarea,select{width:100%;padding:10px;border:1px solid #2f3744;border-radius:8px;background:#0d121a;color:#fff}
    textarea{min-height:120px}
    .toolbar{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
    .toolbar button,.actions button{border:none;border-radius:8px;padding:8px 10px;font-weight:700;cursor:pointer}
    .toolbar button{background:#2d3748;color:#fff}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .save{background:#2ecc71}.pub{background:#5865f2;color:#fff}.dark{background:#2d3748;color:#fff}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}

    .preview{background:#2b2d31;border-left:4px solid #2ecc71;border-radius:8px;padding:12px}
    .preview2{margin-top:12px}
    .title{font-weight:800;font-size:28px;margin:0 0 8px}
    .desc{white-space:pre-wrap;line-height:1.4}
    .img{max-width:100%;border-radius:10px;margin-top:12px}
    .btns{display:flex;gap:8px;margin-top:10px}
    .btn{border-radius:8px;padding:8px 12px;font-weight:700;color:#fff;background:#3a3f45}
    .status{margin-top:10px;white-space:pre-wrap;color:#9ad0ff}
    @media (max-width: 1000px){.wrap{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>–ü–æ–ª–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ—Å—Ç–∞</h2>
    <label>–ò–º—è —à–∞–±–ª–æ–Ω–∞</label><input id="name" value="ticket">
    <div class="row">
      <div><label>Channel ID</label><input id="channel_id" placeholder="123..."></div>
      <div><label>–¶–≤–µ—Ç</label><input id="color_hex" value="2ECC71"></div>
    </div>

    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label><input id="title" value="CapybarBuild">

    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
    <div class="toolbar">
      <button onclick="wrapText('description','**','**')"><b>B</b></button>
      <button onclick="wrapText('description','*','*')"><i>I</i></button>
      <button onclick="wrapText('description','__','__')"><u>U</u></button>
      <button onclick="wrapText('description','~~','~~')">S</button>
      <button onclick="wrapText('description','```\n','\n```')">Code</button>
      <button onclick="wrapText('description','> ','')">Quote</button>
      <button onclick="insertEmoji('description','üéÅ')">üéÅ</button>
      <button onclick="insertEmoji('description','üí¨')">üí¨</button>
      <button onclick="insertEmoji('description','üìã')">üìã</button>
    </div>
    <textarea id="description">üéÅ : We work with projects of any complexity and are ready to create something amazing for you

üí¨ : Our staff will provide the most comfortable communication with an individual approach to the client</textarea>

    <label>Image URL</label><input id="image_url" placeholder="https://...">

    <div class="row">
      <div><label>–ö–Ω–æ–ø–∫–∞ Order label</label><input id="order_label" value="ORDER"></div>
      <div><label>–ö–Ω–æ–ø–∫–∞ Order emoji</label><input id="order_emoji" value="üßæ"></div>
    </div>
    <div class="row">
      <div><label>–ö–Ω–æ–ø–∫–∞ Order color</label>
        <select id="order_style"><option>success</option><option>primary</option><option>secondary</option><option>danger</option></select>
      </div>
      <div><label>–ö–Ω–æ–ø–∫–∞ Support color</label>
        <select id="support_style"><option>primary</option><option>success</option><option>secondary</option><option>danger</option></select>
      </div>
    </div>
    <div class="row">
      <div><label>–ö–Ω–æ–ø–∫–∞ Support label</label><input id="support_label" value="SUPPORT"></div>
      <div><label>–ö–Ω–æ–ø–∫–∞ Support emoji</label><input id="support_emoji" value="üõü"></div>
    </div>

    <label><input type="checkbox" id="is_ticket_panel" checked> –≠—Ç–æ ticket panel (–∫–Ω–æ–ø–∫–∏)</label>

    <label><input type="checkbox" id="split_enabled"> –†–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ—Å—Ç –Ω–∞ 2 —á–∞—Å—Ç–∏</label>
    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2 —á–∞—Å—Ç–∏</label><input id="split_title" placeholder="–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ">
    <label>–¢–µ–∫—Å—Ç 2 —á–∞—Å—Ç–∏</label><textarea id="split_description"></textarea>
    <label>–¶–≤–µ—Ç 2 —á–∞—Å—Ç–∏</label><input id="split_color_hex" value="2ECC71">

    <label>–ê–≤—Ç–æ-—Ç–µ–∫—Å—Ç –≤ ORDER —Ç–∏–∫–µ—Ç–µ</label><textarea id="auto_order_message">–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑! –û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –∏ –±—é–¥–∂–µ—Ç.</textarea>
    <label>–ê–≤—Ç–æ-—Ç–µ–∫—Å—Ç –≤ SUPPORT —Ç–∏–∫–µ—Ç–µ</label><textarea id="auto_support_message">–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ —Å–∞–ø–ø–æ—Ä—Ç! –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–æ.</textarea>

    <div class="actions">
      <button class="save" onclick="savePost()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="pub" onclick="publishPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ Discord</button>
      <button class="dark" onclick="loadPost()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      <button class="dark" onclick="listPosts()">–°–ø–∏—Å–æ–∫</button>
    </div>
    <div class="status" id="status"></div>
  </div>

  <div class="card">
    <h2>Live preview</h2>
    <div class="preview" id="preview">
      <div class="title" id="p_title"></div>
      <div class="desc" id="p_desc"></div>
      <img id="p_img" class="img" style="display:none"/>
    </div>
    <div class="btns" id="btns" style="display:none">
      <div class="btn" id="p_order_btn">üßæ ORDER</div>
      <div class="btn" id="p_support_btn">üõü SUPPORT</div>
    </div>
    <div class="preview preview2" id="preview2" style="display:none">
      <div class="title" id="p2_title"></div>
      <div class="desc" id="p2_desc"></div>
    </div>
  </div>
</div>

<script>
const FIELDS=["name","channel_id","title","description","color_hex","image_url","is_ticket_panel","order_label","order_emoji","order_style","support_label","support_emoji","support_style","split_enabled","split_title","split_description","split_color_hex","auto_order_message","auto_support_message"];
FIELDS.forEach(id=>{const el=document.getElementById(id); el.addEventListener('input', updatePreview); el.addEventListener('change', updatePreview);});

function val(id){return document.getElementById(id).value}
function chk(id){return document.getElementById(id).checked}
function getPayload(){
  return {
    name: val('name').trim().toLowerCase(), channel_id: val('channel_id').trim(),
    title: val('title'), description: val('description'), color_hex: val('color_hex').replace('#',''), image_url: val('image_url').trim(),
    is_ticket_panel: chk('is_ticket_panel'),
    order_label: val('order_label'), order_emoji: val('order_emoji'), order_style: val('order_style'),
    support_label: val('support_label'), support_emoji: val('support_emoji'), support_style: val('support_style'),
    split_enabled: chk('split_enabled'), split_title: val('split_title'), split_description: val('split_description'), split_color_hex: val('split_color_hex').replace('#',''),
    auto_order_message: val('auto_order_message'), auto_support_message: val('auto_support_message')
  }
}

function applyMarkdownPreview(text){
  return text
    .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
    .replace(/\*(.*?)\*/g, '<i>$1</i>')
    .replace(/__(.*?)__/g, '<u>$1</u>')
    .replace(/~~(.*?)~~/g, '<s>$1</s>')
    .replace(/\n/g,'<br>');
}

function btnColor(style){
  if(style==='success')return '#2ecc71'; if(style==='primary')return '#5865f2'; if(style==='danger')return '#ed4245'; return '#4f545c';
}

function updatePreview(){
  const p=getPayload();
  document.getElementById('p_title').textContent=p.title||'(–±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞)';
  document.getElementById('p_desc').innerHTML=applyMarkdownPreview(p.description||'(–±–µ–∑ —Ç–µ–∫—Å—Ç–∞)');
  document.getElementById('preview').style.borderLeftColor='#'+(p.color_hex||'2ECC71');
  const img=document.getElementById('p_img');
  if(p.image_url){img.src=p.image_url; img.style.display='block'} else img.style.display='none';

  const btns=document.getElementById('btns');
  btns.style.display=p.is_ticket_panel?'flex':'none';
  const ob=document.getElementById('p_order_btn');
  const sb=document.getElementById('p_support_btn');
  ob.textContent=`${p.order_emoji} ${p.order_label}`;
  sb.textContent=`${p.support_emoji} ${p.support_label}`;
  ob.style.background=btnColor(p.order_style); sb.style.background=btnColor(p.support_style);

  const p2=document.getElementById('preview2');
  if(p.split_enabled){
    p2.style.display='block'; p2.style.borderLeftColor='#'+(p.split_color_hex||'2ECC71');
    document.getElementById('p2_title').textContent=p.split_title||'–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ';
    document.getElementById('p2_desc').innerHTML=applyMarkdownPreview(p.split_description||'');
  } else p2.style.display='none';
}

function wrapText(id, left, right){
  const t=document.getElementById(id); const s=t.selectionStart; const e=t.selectionEnd;
  const before=t.value.slice(0,s), sel=t.value.slice(s,e), after=t.value.slice(e);
  t.value=before+left+sel+right+after; t.focus(); t.selectionStart=s+left.length; t.selectionEnd=e+left.length; updatePreview();
}
function insertEmoji(id, emoji){
  const t=document.getElementById(id); const s=t.selectionStart;
  t.value=t.value.slice(0,s)+emoji+t.value.slice(s); t.focus(); t.selectionStart=t.selectionEnd=s+emoji.length; updatePreview();
}

async function savePost(){
  const p=getPayload(); if(!p.name||!p.channel_id) return setStatus('–ù—É–∂–Ω—ã name –∏ channel_id');
  const res=await fetch('/api/posts/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)});
  setStatus(JSON.stringify(await res.json(),null,2));
}
async function publishPost(){
  const p=getPayload(); if(!p.name) return setStatus('–°–Ω–∞—á–∞–ª–∞ name');
  await savePost();
  const res=await fetch(`/api/posts/${encodeURIComponent(p.name)}/publish`,{method:'POST'});
  setStatus(JSON.stringify(await res.json(),null,2));
}
async function loadPost(){
  const name=val('name').trim().toLowerCase(); if(!name) return setStatus('–£–∫–∞–∂–∏ name');
  const res=await fetch(`/api/posts/${encodeURIComponent(name)}`); const d=await res.json();
  if(d.error) return setStatus(JSON.stringify(d,null,2));
  FIELDS.forEach(k=>{if(k==='name')return; const el=document.getElementById(k); if(!el)return; if(el.type==='checkbox')el.checked=!!d[k]; else el.value=d[k]??''});
  updatePreview(); setStatus('–ó–∞–≥—Ä—É–∂–µ–Ω–æ');
}
async function listPosts(){ const res=await fetch('/api/posts'); setStatus(JSON.stringify(await res.json(),null,2)); }
function setStatus(t){document.getElementById('status').textContent=t}
updatePreview();
</script>
</body>
</html>
